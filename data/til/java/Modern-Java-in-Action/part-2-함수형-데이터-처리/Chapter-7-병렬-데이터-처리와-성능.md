---
title: Chapter 7. ë³‘ë ¬ ë°ì´í„° ì²˜ë¦¬ì™€ ì„±ëŠ¥
date: '2022-04-25'
tags: ['TIL', 'Java', 'Modern Java In Action']
draft: true
summary: Chapter 7. ë³‘ë ¬ ë°ì´í„° ì²˜ë¦¬ì™€ ì„±ëŠ¥
---

# Chapter 7. ë³‘ë ¬ ë°ì´í„° ì²˜ë¦¬ì™€ ì„±ëŠ¥

ì•ì„œ `ë°ì´í„° ì»¬ë ‰ì…˜`ì„ `ì„ ì–¸í˜•`ìœ¼ë¡œ ì œì–´í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.  
ë˜í•œ, `ì™¸ë¶€ ë°˜ë³µ`ì„ `ë‚´ë¶€ ë°˜ë³µ`ìœ¼ë¡œ ë°”ê¾¸ë©´ `ë„¤ì´í‹°ë¸Œ ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬`ê°€ `Stream` ìš”ì†Œì˜ ì²˜ë¦¬ë¥¼ ì œì–´í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°œë°œìëŠ” `Collection`ì˜ ì²˜ë¦¬ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ë”°ë¡œ ê³ ë¯¼í•  í•„ìš”ê°€
ì—†ìŠµë‹ˆë‹¤.

> ğŸ’¡ ê°€ì¥ í° íŠ¹ì§•ì€ `ë©€í‹°ì½”ì–´`ë¥¼ í™œìš©í•´ì„œ `Pipeline` ì—°ì‚°ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

`Java 7`ì´ ë“±ì¥í•˜ê¸° ì´ì „ì—ëŠ” ë°ì´í„°ë¥¼ `ë³‘ë ¬`ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„ , ë°ì´í„°ë¥¼ `ì„œë¸ŒíŒŒíŠ¸`ë¡œ `ë¶„í• `í•˜ê³  ê° `Thread`ë¡œ í• ë‹¹ í•œ í›„, ì˜ë„ì¹˜ ì•Šì€ `race condition`ì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡
ì ì ˆí•œ `ë™ê¸°í™”`ë¥¼ ì¶”ê°€í•œ ë’¤, `ë¶€ë¶„ ê²°ê³¼`ë¥¼ í•©ì³ì•¼ í–ˆìŠµë‹ˆë‹¤.

`Java 7`ì€ ë” ì‰½ê²Œ `ë³‘ë ¬í™”`ë¥¼ ìˆ˜í–‰í•˜ë©´ì„œ ì—ëŸ¬ë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆë„ë¡ `Fork/Join Framework` ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

`Stream`ì„ ì´ìš©í•˜ë©´ `ìˆœì°¨ ìŠ¤íŠ¸ë¦¼`ì—ì„œ `ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼`ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 7.1 ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼

`Collector`ì— `parallelStream`ì„ í˜¸ì¶œí•˜ë©´ `ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼`ì´ ìƒì„±ë©ë‹ˆë‹¤.

`ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼`ì´ë€ ê°ê°ì˜ `Thread`ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ `Stream`ìš”ì†Œë¥¼ `ì—¬ëŸ¬ ì²­í¬`ë¡œ ë¶„í• í•œ `Stream`ì…ë‹ˆë‹¤. ë”°ë¼ì„œ, `ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼`ì„ ì´ìš©í•˜ë©´ ëª¨ë“  `ë©€í‹°ì½”ì–´ í”„ë¡œì„¸ì„œ`ê°€ ê°ê°ì˜ `ì²­í¬`ë¥¼
ì²˜ë¦¬í•˜ë„ë¡ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ì²˜ëŸ¼ `ë¬´í•œ ìŠ¤íŠ¸ë¦¼`ì„ ë§Œë“  ë‹¤ìŒ ì¸ìˆ˜ë¡œ ì£¼ì–´ì§„ í¬ê¸°ë¡œ `Stream`ì„ ì œí•œí•˜ê³ , ë‘ ìˆ«ìë¥¼ ë”í•˜ëŠ” `BinaryOperator`ë¡œ `reducing`ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

```java
class Foo {
	public long sequentialSum(long n) {
		return Stream.iterate(1L, i -> i + 1)
				.limit(n)
				.reduce(0L, Long::sum);
	}
}
```

ê¸°ì¡´ì˜ ìë°” ì½”ë“œëŠ” ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
class Foo {
	public long iterativeSum(long n) {
		long result = 0;
		for (long i = 1L; i <= n; i++) {
			result += i;
		}
		return result;
	}
}
```

íŠ¹íˆ `n`ì´ ì»¤ì§„ë‹¤ë©´ `ë³‘ë ¬`ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë” ì¢‹ìŠµë‹ˆë‹¤.

ìœ„ì˜ ì½”ë“œë¥¼ `ë³‘ë ¬ ì²˜ë¦¬` í•˜ë ¤ë©´ ê²°ê³¼ ë³€ìˆ˜ë¥¼ ì–´ë–»ê²Œ `ë™ê¸°í™”`ë¥¼ í•˜ê³ , ëª‡ ê°œì˜ `Thread`ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ë©°, ìˆ«ìëŠ” ì–´ë–»ê²Œ ìƒì„±í• ì§€ ë“±ë“± ë§ì€ ê³ ë¯¼ì´ í•„ìš”í•©ë‹ˆë‹¤.

`ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼`ì„ ì´ìš©í•˜ë©´ ì´ëŸ° ê±±ì • ì—†ì´ ëª¨ë“  ë¬¸ì œë¥¼ ì‰½ê²Œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 7.1.1 ìˆœì°¨ ìŠ¤íŠ¸ë¦¼ì„ ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜í•˜ê¸°

`ìˆœì°¨ ìŠ¤íŠ¸ë¦¼`ì— `parallel` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ê¸°ì¡´ì˜ `í•¨ìˆ˜í˜• reducing ì—°ì‚°`ì´ `ë³‘ë ¬`ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

```java
public class ParallelStreams {
	public static long parallelSum(long n) {
		return Stream.iterate(1L, i -> i + 1)
				.limit(n)
				.parallel()
				.reduce(Long::sum);
	}
}
```

ì´ì „ ì½”ë“œì™€ ë‹¤ë¥¸ ì ì€ `Stream`ì´ ì—¬ëŸ¬ `ì²­í¬`ë¡œ ë¶„í• ë˜ì–´ `reducing ì—°ì‚°`ì„ `ë³‘ë ¬`ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

`parallel` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì ìœ¼ë¡œ ë³‘ë ¬ë¡œ ìˆ˜í–‰í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ëŠ” `boolean flag`ê°€ ì„¤ì •ë©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ, `sequential` ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ë©´ `ìˆœì°¨ ìŠ¤íŠ¸ë¦¼`ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜
ìˆìŠµë‹ˆë‹¤.

`parallel`ê³¼ `sequential` ë©”ì†Œë“œ ì¤‘ ìµœì¢…ì ì„ í˜¸ì¶œ ëœ ë©”ì†Œë“œê°€ ì „ì²´ `Pipeline`ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.

> #### ğŸ’¡ ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìŠ¤ë ˆë“œ í’€ ì„¤ì •
>
> `ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼`ì€ ë‚´ë¶€ì ìœ¼ë¡œ `ForkJoinPool`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
>
> `ForkJoinPool`ì€ í”„ë¡œì„¸ì„œ ìˆ˜, ì¦‰ `Runtime.getRuntime().availableProcessors()`ê°€ ë°˜í™˜í•˜ëŠ” ê°’ì— ìƒì‘í•˜ëŠ” `Thread`ë¥¼ ê°–ìŠµë‹ˆë‹¤.
>
> íŠ¹ë³„í•œ ì´ìœ ê°€ ì—…ë‹¤ë©´ `ForkJoinPool`ì˜ `ê¸°ë³¸ê°’`ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ê²ƒì„ `ê¶Œì¥`í•©ë‹ˆë‹¤.
